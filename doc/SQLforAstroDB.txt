GWAC查询需求整理
查询结果展示：一般需要展示目标的位置，多波段星等，时间，切图，椭率，半高全宽，天区，CCD等属性
普通数据：'imageid','zone','ra','dec','mag','x_pix','y_pix','ra_err','dec_err','x','y','z','flux','flux_err','normmag','flag','background','threshold','mag_err','ellipticity','class_star','orig_catid','timestamp'
template表：'imageid_str','zone','ra','dec','mag_avg','x_pix','y_pix','ra_err','dec_err','x','y','z','flux','flux_err','normmag','flag','background','threshold','mag_err','ellipticity','class_star','orig_catid'
1.	按位置区域查询：按赤经、赤纬，一定的搜索半径来查询历史数据中该区域内的目标；
(1) 
Select orig_catid
From template
where 180/3.1415926*3600*acos( sin(radians(dec))*sin(radians ($con_dec))+cos(radians(dec))*cos(radians($con_dec))*cos(radians(ra)- radians($con_ra))) <$d

2.	按目标ID查询：查询ID对应的目标的历史信息
(1)

Select mag, timestamp
From $star_id
where timestamp >$timeMin and timestamp<$timeMax (包含时间范围)

3.	按目标ID区域查询：查询ID对应的目标的周围一定半径内的数据
(1)
Select orig_catid
From template, (Select ra, dec From template where orig_catid=$id) as rd
Where orig_catid <> $id and 180/3.1415926*3600*acos( sin(radians(dec))*sin(radians (rd.dec))+cos(radians(dec))*cos(radians(rd.dec))*cos(radians(ra)- radians(rd.ra))) <$d

4.	按星等查询：查询星等值在某个范围内[magMin,magMax]的所有目标
Select orig_catid
From template
Where mag >$magMin and mag<$magMax

5.	按变星查询：查询特定周期的星，变化规律或不规律的，变化值大于Mag的

6.	按时间查询：查询某一个时刻，某一位置或一个区域内的星的信息
    1号查询和2号查询的组合
7.	按测光属性查询，测光属性包括：星等、椭率、半高全宽、饱和度、视场，多波段星等，光谱等等
    Select *
	from template
8.	组合查询：查询一个区域内星等值在某个范围的星，等等
    Select orig_catid
From template
where mag >$magMin and mag<$magMax and 180/3.1415926*3600*acos( sin(radians(dec))*sin(radians ($con_dec))+cos(radians(dec))*cos(radians($con_dec))*cos(radians(ra)- radians($con_ra))) <$d
a)	查询亮星（8~10等）在3度范围内的暗星（12~14等）

9) 查询同一势场（假设势场为14）的星ID和时间戳
select orig_catid
from template
where imageid_str like '%14%'

select timestamp
from $orig_catid
where imageid = '14'

%%%%%%给出更新势场串
update template set imageid_str=concat(imageid_str,'_$newimageid') where imageid_str not like '$newimageid';
%%%%%%给出更新势场串

--------------------------------------------------------------------------------------------------
原始模板表 template1 表头
ccd_num  imageid                                                                                                                                                                                     orig_catid   timestamp                        
1        2       1210 233.4134 3.3632 11.2695 1.8190 3.1795 0.6752 0.0722 0.3831251357307454 -0.4565907569202600 -0.8029570418560895 0.0000 0.0970 0.4429 0.2105 0.8705 0.8237 0.2010 0.6493 0.0000  1            41210

读入dataFrame中的模板表

+--------+-------+----+--------+------+-------+--------+-------+------+-------+------------------+-------------------+-------------------+----+--------+-------+------+----------+---------+-------+-----------+----------+
| star_id|ccd_num|zone|      ra|   dec|    mag|   x_pix|  y_pix|ra_err|dec_err|                 x|                  y|                  z|flux|flux_err|normmag|  flag|background|threshold|mag_err|ellipticity|class_star|
+--------+-------+----+--------+------+-------+--------+-------+------+-------+------------------+-------------------+-------------------+----+--------+-------+------+----------+---------+-------+-----------+----------+
| ref_1_1|      1|1210|233.4134|3.3632|11.2695|   1.819| 3.1795|0.6752| 0.0722|0.3831251357307454|  -0.45659075692026|-0.8029570418560895| 0.0|   0.097| 0.4429|0.2105|    0.8705|   0.8237|  0.201|     0.6493|       0.0|
| ref_1_2|      1|1223|233.4151|3.3989|16.1528|  2.5733|14.3772|0.6402| 0.0694|0.4759973095798349|-0.3586897004719179| -0.802974632256913| 0.0|  0.3686| 0.4115|0.6033|    0.8223|   0.2251| 0.2937|     0.8832|    0.7069|
| ref_1_3|      1|1212|233.4209|3.3689|16.0851|  4.2107| 4.9527|0.5254| 0.3557|0.3987560146316823|-0.4428634202133609|-0.8030352618857916| 0.0|   0.363| 0.2481| 0.875|    0.9609|   0.3582| 0.3599|     0.7991|    0.1897|
| ref_1_4|      1|1208|233.4327|3.3578| 15.284|  7.8341|  1.452|0.3477| 0.9171|0.3667903484711391| -0.469470237294819|-0.8031578528301686| 0.0|  0.2036| 0.0011|0.1019|     0.526|   0.1475|  0.301|     0.9301|    0.0766|
| ref_1_5|      1|1219|233.4394|3.3887|16.4177| 10.1321|11.1102|0.8419| 0.1859|0.4495594364273351|-0.3907960559464187| -0.803227711035831| 0.0|   0.271| 0.0558| 0.373|    0.1419|   0.0759| 0.1171|     0.7417|    0.4312|
| ref_1_6|      1|1217| 233.446|3.3827|16.7669| 12.1424| 9.2249|0.1185| 0.6664|  0.43557996461282|-0.4061848882207637|  -0.80329566848638| 0.0|  0.9161| 0.9796|0.3607|    0.4911|   0.7915| 0.9743|      0.134|    0.0838|
| ref_1_7|      1|1213| 233.459|3.3719|12.2389| 16.1441| 5.8269| 0.012| 0.1072|0.4060606710214184| -0.435446757974995|-0.8034306767971344| 0.0|  0.9472| 0.8291|0.3811|     0.942|    0.854|  0.423|     0.1605|    0.7764|
| ref_1_8|      1|1216|233.4683|3.3783|14.3998| 19.1029| 7.8131|0.7026| 0.3306|0.4281996956695552|-0.4135076394838941|-0.8035275058869846| 0.0|  0.5194| 0.3482|0.9238|    0.8706|   0.5227| 0.4913|     0.5899|    0.1053|
| ref_1_9|      1|1215| 233.483|3.3756|16.5298| 23.7069| 6.9274|0.0829| 0.3594|0.4207714527087739|-0.4207714527087753| -0.803680763220506| 0.0|  0.0551| 0.3511|0.6621|    0.5884|    0.185| 0.3164|      0.593|    0.7644|
|ref_1_10|      1|1215|233.4838| 3.377|17.4223| 23.9517| 7.3466|0.6887| 0.6051|0.4207639644698137|-0.4207639644698151|-0.8036886041292918| 0.0|   0.826| 0.7813| 0.699|    0.7008|   0.4231| 0.9512|     0.0874|    0.7192|
|ref_1_11|      1|1210|233.5118|3.3618|13.8791| 32.6333| 2.5295|0.5825| 0.9961| 0.382238138922088|-0.4555336752869228|-0.8039795245110207| 0.0|  0.4758| 0.5484|0.1566|    0.1754|   0.0911| 0.2667|     0.0606|    0.6578|
|ref_1_12|      1|1221|233.5197|3.3929|12.7391| 35.2917|12.2738|0.2164| 0.8336|0.4620494009641311|-0.3741602274480719|-0.8040612385040673| 0.0|  0.7045| 0.2633|0.9902|    0.0995|   0.7559| 0.5453|     0.6567|    0.3609|
|ref_1_13|      1|1220|233.5653|  3.39|15.6936| 49.5434|11.2703|0.0094| 0.6602|0.4549589543515294|-0.3817558907971693|-0.8045338959279608| 0.0|  0.1454| 0.8424|0.7391|    0.7852|   0.5451|   0.84|     0.5834|    0.0689|
|ref_1_14|      1|1208|233.6235|3.3571|16.1144| 67.5883| 0.8263|0.5568| 0.5043|0.3651414534013688|-0.4673597478479022|-0.8051376187332705| 0.0|    0.56| 0.9797|0.7193|    0.4172|   0.2496| 0.4825|     0.2138|     0.803|
|ref_1_15|      1|1216|233.6259|3.3789|15.8196| 68.4611|  7.649|0.9473| 0.8007|0.4266079200761617|-0.4119704796613421|-0.8051620994656262| 0.0|  0.6911| 0.1766|0.2511|    0.1172|   0.6808| 0.8233|     0.9981|    0.3154|
|ref_1_16|      1|1223|233.6688|3.3976|16.0038| 81.9888|13.4524|0.8189| 0.6713|0.4731534950901466|-0.3565467325454723| -0.805605485082572| 0.0|  0.1977| 0.1954|0.9151|    0.3372|   0.6592| 0.5021|     0.8198|    0.6089|
|ref_1_17|      1|1215|233.7395|3.3767|15.2473|103.9815| 6.7516|0.7878| 0.8518|0.4182240041120436|-0.4182240041120449|-0.8063357642874199| 0.0|  0.6942| 0.8669|0.0514|    0.0469|   0.8505| 0.5495|     0.0777|     0.101|
|ref_1_18|      1|1223|233.7467|3.3981|14.7513|106.3663|13.4348|0.9201|  0.713|0.4722783155529133| -0.355887237460623|-0.8064102348501964| 0.0|  0.6521| 0.4283|0.2241|    0.9147|   0.6383|  0.468|     0.8577|    0.1628|
|ref_1_19|      1|1220|233.7528|3.3892|15.2585|108.2215|10.6231|0.1946| 0.5596|0.4529396042952485|-0.3800614549097262|-0.8064731894816876| 0.0|  0.6734| 0.6916|0.3925|    0.0801|   0.9581| 0.4025|     0.5479|    0.2762|
|ref_1_20|      1|1208|233.8399|3.3573|14.7634|135.2948| 0.4617|0.4964| 0.1827|0.3632669388869648|-0.4649604786807663|-0.8073715900232351| 0.0|  0.5593| 0.8815|0.5543|    0.1938|   0.3905| 0.2242|     0.1309|    0.3748|


原始表
+------------+-------+-------+----+--------+-------+-------+---------+---------+------+-------+-------------------+-------------------+-------------------+----+--------+-------+------+----------+---------+-------+-----------+----------+----------+---------+
|     star_id|ccd_num|imageid|zone|      ra|    dec|    mag|    x_pix|    y_pix|ra_err|dec_err|                  x|                  y|                  z|flux|flux_err|normmag|  flag|background|threshold|mag_err|ellipticity|class_star|orig_catid|timestamp|
+------------+-------+-------+----+--------+-------+-------+---------+---------+------+-------+-------------------+-------------------+-------------------+----+--------+-------+------+----------+---------+-------+-----------+----------+----------+---------+
|ref_2_123941|      2|    970|4425|241.2062|12.2925|16.5229|2410.4631|2754.0739| 0.137| 0.2535| 0.1246625819191479|-0.4652470895249766|-0.8763585946162622| 0.0|  0.3755| 0.5727|0.7438|    0.6186|   0.6769| 0.5291|     0.9664|    0.1155|    123941|    36792|
|ref_2_123941|      2|    971|4425|241.2062|12.2925|16.9585|2410.4631|2754.0739|0.0505| 0.2507| 0.1246625819191479|-0.4652470895249766|-0.8763585946162622| 0.0|  0.2767| 0.1877|0.8675|    0.6185|   0.4936| 0.6213|      0.856|    0.9681|    123941|    36809|
|ref_2_123941|      2|    972|4425|241.2062|12.2925|16.9071|2410.4631|2754.0739|0.8757| 0.0484| 0.1246625819191479|-0.4652470895249766|-0.8763585946162622| 0.0|  0.2167|  0.563|0.2387|    0.6299|   0.8232| 0.1395|     0.0777|    0.5712|    123941|    36823|
|ref_2_123941|      2|    973|4425|241.2062|12.2925|15.1383|2410.4631|2754.0739|0.3286| 0.7602| 0.1246625819191479|-0.4652470895249766|-0.8763585946162622| 0.0|  0.2316| 0.0867|0.5031|    0.5418|   0.6611| 0.0067|     0.1779|    0.2153|    123941|    36839|
|ref_2_123941|      2|    974|4425|241.2062|12.2925|15.6423|2410.4631|2754.0739|0.4146| 0.5338| 0.1246625819191479|-0.4652470895249766|-0.8763585946162622| 0.0|  0.7387| 0.1363|0.2583|    0.6802|   0.4508| 0.3932|     0.8672|    0.4075|    123941|    36855|
|ref_2_123941|      2|    975|4425|241.2062|12.2925|16.8275|2410.4631|2754.0739|0.1539| 0.9752| 0.1246625819191479|-0.4652470895249766|-0.8763585946162622| 0.0|   0.318| 0.3431| 0.876|    0.9141|   0.6095| 0.1037|     0.5057|    0.0388|    123941|    36870|
|ref_2_123941|      2|    976|4425|241.2062|12.2925|16.5785|2410.4631|2754.0739|0.7976| 0.7937| 0.1246625819191479|-0.4652470895249766|-0.8763585946162622| 0.0|  0.6493| 0.9714|0.0604|    0.3469|   0.0332| 0.5817|     0.9865|     0.393|    123941|    36886|
|ref_2_159901|      2|    970|5488|239.5237|15.2455|15.7962|1905.4926|3666.1747|0.7954|  0.632|-0.0177004170538092|-0.5068736259660191|-0.8618386290577729| 0.0|  0.8247| 0.4003|0.8201|    0.9665|   0.6407| 0.1504|     0.7907|    0.6846|    159901|    36792|
|ref_2_159901|      2|    971|5488|239.5237|15.2455|16.2796|1905.4926|3666.1747|0.3874| 0.4766|-0.0177004170538092|-0.5068736259660191|-0.8618386290577729| 0.0|  0.6613|  0.695|0.2963|    0.6034|   0.4218| 0.7938|     0.3666|     0.816|    159901|    36809|
|ref_2_159901|      2|    972|5488|239.5237|15.2455|16.5874|1905.4926|3666.1747|0.7944| 0.2996|-0.0177004170538092|-0.5068736259660191|-0.8618386290577729| 0.0|   0.753| 0.7568|0.0537|    0.3066|   0.1709| 0.8541|     0.7328|    0.7856|    159901|    36823|
|ref_2_159901|      2|    973|5488|239.5237|15.2455|15.9287|1905.4926|3666.1747|0.9965| 0.6494|-0.0177004170538092|-0.5068736259660191|-0.8618386290577729| 0.0|  0.2887| 0.8842|0.7766|     0.488|   0.5097| 0.8819|     0.4039|    0.3018|    159901|    36839|
|ref_2_159901|      2|    974|5488|239.5237|15.2455|18.0007|1905.4926|3666.1747|0.6927|  0.791|-0.0177004170538092|-0.5068736259660191|-0.8618386290577729| 0.0|  0.0629| 0.2352|0.7277|    0.3715|    0.615| 0.6113|     0.2738|    0.1598|    159901|    36855|
|ref_2_159901|      2|    975|5488|239.5237|15.2455|16.6972|1905.4926|3666.1747|0.2852| 0.7725|-0.0177004170538092|-0.5068736259660191|-0.8618386290577729| 0.0|  0.9571| 0.8968|0.1071|    0.6751|   0.6107|  0.747|     0.8795|    0.7538|    159901|    36870|
|ref_2_159901|      2|    976|5488|239.5237|15.2455| 15.859|1905.4926|3666.1747|0.4568| 0.5123|-0.0177004170538092|-0.5068736259660191|-0.8618386290577729| 0.0|   0.349| 0.5618|0.0136|    0.6611|   0.2533| 0.4199|     0.4177|    0.1905|    159901|    36886|
|ref_2_159901|      2|    977|5488|239.5237|15.2455|16.6549|1905.4926|3666.1747|0.7971| 0.0209|-0.0177004170538092|-0.5068736259660191|-0.8618386290577729| 0.0|  0.7932| 0.4777|0.4714|     0.284|   0.8684| 0.7256|      0.006|     0.689|    159901|    36902|
|ref_2_159901|      2|    978|5488|239.5237|15.2455|15.5161|1905.4926|3666.1747|0.7646| 0.1149|-0.0177004170538092|-0.5068736259660191|-0.8618386290577729| 0.0|   0.017| 0.5082|0.5526|    0.1733|   0.4362| 0.3679|     0.2581|    0.2573|    159901|    36917|
|ref_2_110631|      2|    970|4075|234.6356| 11.321|16.5744| 424.1083|2468.9648|0.4785| 0.0383| 0.2446004956568454|-0.5245474556961679|-0.8154879301664142| 0.0|  0.8287| 0.8912|0.7687|    0.3719|   0.7187| 0.7707|     0.4765|    0.4425|    110631|    36792|
|ref_2_110631|      2|    971|4075|234.6356| 11.321|16.2731| 424.1083|2468.9648|0.2894| 0.2708| 0.2446004956568454|-0.5245474556961679|-0.8154879301664142| 0.0|  0.4317| 0.2666|0.7684|    0.3211|   0.9234| 0.3911|     0.9977|    0.9288|    110631|    36809|
|ref_2_110631|      2|    972|4075|234.6356| 11.321|15.1858| 424.1083|2468.9648|0.9313| 0.8306| 0.2446004956568454|-0.5245474556961679|-0.8154879301664142| 0.0|  0.1427| 0.2694|0.6455|    0.9497|      0.2| 0.8795|     0.0965|    0.4357|    110631|    36823|
|ref_2_110631|      2|    973|4075|234.6356| 11.321|15.5754| 424.1083|2468.9648|0.4219| 0.4955| 0.2446004956568454|-0.5245474556961679|-0.8154879301664142| 0.0|  0.7849| 0.5215|0.8996|    0.6957|   0.7816| 0.2509|     0.0494|    0.5955|    110631|    36839|
+------------+-------+-------+----+--------+-------+-------+---------+---------+------+-------+-------------------+-------------------+-------------------+----+--------+---
+------------+-------+-------+----+--------+-------+-------+---------+---------+------+-------+-------------------+-------------------+-------------------+----+--------+---


--------------------------------------------------------------------------
    //////////////////////////////////用户查询
    //q0 输出全部的模板表
    //
    //q1 按星等查询：查询星等值在某个范围内[magMin,magMax]的所有目标，返回星id（只需要模板表）
    //    参数列表 ： magMin magMax  1 10
    //q2 按位置区域查询：按赤经（ra）、赤纬（dec），一定的搜索半径（searchRadius）来查询该区域内的目标,返回星id（只需要模板表）
    //    参数列表: ra dec searchRadius
    //q3 查询某颗星的ra和dec（只需要模板表）
    //    参数列表: star_id
    //q4 查询某视场的星ID 只需要模板表
    //     参数列表: ccd_num
	
    //q5 按目标ID所在区域查询该ID对应的目标的周围一定半径内的星id（只需要模板表）；两次查询（嵌套查询）模板表
    //    参数列表：star_id searchRadius
		1. q3 根据ID 得到 ra和dec
		2. q2 根据searchRadius ra和dec得到星id 
	
    //q6 查询某个星集合在某个时间范围的光变曲线返回光变曲线（mag）和时间戳（timestamp）(只需要原始表)
    //   参数列表：star_id_set timeMin timeMax  [ref_1_1 ref_1_11 ref_2_1],36588,36988 需要有逗号
	
    //q7 查询某个星集合所有星在给定的时间范围都被哪些CCD拍过（只需要原始表）
    //    参数列表：star_id_set, timeMin timeMax  [ref_1_1 ref_1_11 ref_2_1],36588,36988 需要有逗号
    //q8 按位置区域查询：按 赤经、赤纬，一定的搜索半径和一定时间范围来查询该区域内的所有目标的光变曲线和时间戳（需要模板表和原始表）
    //   参数列表：ra dec searchRadius timeMin timeMax
	
		1.q2 先查得到星列表 
		2.q6把 星列表 时间范围 作为条件得到 光变曲线
	
    //q9 按目标ID所在区域查询该ID对应的目标的周围一定半径和一定时间范围内的星的光变曲线和时间戳（需要模板表和原始表）
    //   参数列表：star_id searchRadius timeMin timeMax

	
----------------------------------------------------------------------------------------------
查询参数
---------------q6--------
-tempTablePath
temp
-outputPath
result
-redisHost
192.168.0.90:7001
-starTablePath
star
-sliceNum
8
-queryName
q6
-queryParam
"[ref_1_1 ref_1_11 ref_2_1],36588,36988"
-starClusterNum               不同的hash函数这里的数值不同。此处使用了最简单的 star_id%10的哈希函数
10
-fromSource
HDFS

----------------q2--------
-tempTablePath
temp
-outputPath
result
-redisHost
192.168.0.90:7001
-starTablePath
star
-sliceNum
4
-queryName
q2
-queryParam
"233 3.3 10000"
-starClusterNum
10
-fromSource
HDFS

---------------q8--------
-tempTablePath
temp
-outputPath
result
-redisHost
192.168.0.90:7001
-starTablePath
star
-sliceNum
4
-queryName
q8
-queryParam
"233 3.3 1600 36588 36988"
-starClusterNum
10
-fromSource
HDFS

